# CipherSafe

CipherSafe 是一款基於 Python 和 PyQt6 的現代檔案/文字加密工具，旨在提供強大、可靠且易用的加密功能，保護您的數位資產安全。

## 主要功能

- **核心演算法**: 使用 AES-256-GCM 認證加密模式，確保資料的機密性與完整性。
- **金鑰派生**: 使用 Argon2id 演算法從密碼產生金鑰，提供多級可調安全參數，有效抵抗暴力破解。
- **雙重模式**: 支援「金鑰檔案」和「純密碼」兩種加密模式，兼顧最高安全性與便捷性。
- **隱私保護**: 對原始檔名進行加密，防止元資料洩露。
- **使用者體驗**: 提供現代化的圖形使用者介面，支援檔案和資料夾的拖曳操作。
- **輔助工具**: 內建獨立的文字加解密工具和批次重新命名工具。

## 加解密流程解析

CipherSafe 採用了業界標準的“金鑰封裝 (Key Wrapping)”架構，以確保安全性和靈活性。無論使用何種模式，核心流程都遵循多層金鑰保護原則。

### 1. 密碼模式 (Password Mode)

此模式直接使用您提供的密碼來保護檔案。

**加密流程:**

1.  **派生主金鑰 (Master Key)**:
    -   程序將您的密碼和一個隨機生成的鹽 (Salt) 輸入到 **Argon2id** 演算法中。
    -   Argon2id 根據您選擇的安全等級進行高強度的計算，派生出一個 256 位元的**主金鑰**。這個金鑰只存在於記憶體中。

2.  **派生子金鑰**:
    -   使用上一步得到的**主金鑰**，通過 **HKDF-SHA256** 演算法派生出兩個獨立的子金鑰：
        -   **檔名加密金鑰 (FNK)**: 用於加密原始檔名。
        -   **資料加密金鑰 (DEK)**: 用於加密檔案內容。

3.  **執行加密**:
    -   使用 **FNK** 加密原始檔名。
    -   使用 **DEK** 和 **AES-256-GCM** 演算法加密檔案的實際內容。
    -   所有必要的元資料（如 Argon2id 參數、鹽值、加密後的檔名等）和加密後的檔案內容被一同寫入 `.0721` 檔案中。AES-256-GCM 的認證標籤會確保這些元資料和密文的完整性，防止任何篡改。

**解密流程:**
解密是上述過程的逆向操作。程序從檔案中讀取鹽和 Argon2id 參數，使用您輸入的密碼重新派生主金鑰，然後派生出相同的 FNK 和 DEK 來恢復檔名和檔案內容。

### 2. 金鑰檔案模式 (Key File Mode)

此模式使用一個 `.key` 檔案作為安全性的根基，提供最高級別的保護。

**加密流程:**

1.  **獲取主金鑰 (Master Key)**:
    -   在您創建 `.key` 檔案時，程序已在其中生成並儲存了一個 256 位元的、完全隨機的**主金鑰**。
    -   加密時，程序直接從 `.key` 檔案中讀取這個主金鑰。
    -   如果您的 `.key` 檔案本身受密碼保護，則需要先輸入密碼，程序使用 **Argon2id** 派生金鑰來解密 `.key` 檔案，從而獲得主金鑰。

2.  **後續步驟與密碼模式完全相同**:
    -   使用獲取到的**主金鑰**，通過 **HKDF-SHA256** 派生出 **FNK** 和 **DEK**。
    -   使用 **FNK** 加密檔名，使用 **DEK** 加密檔案內容。
    -   將所有資料寫入 `.0721` 檔案。

**解密流程:**
與加密對應，程序從 `.key` 檔案中獲取主金鑰，然後執行與密碼模式相同的後續解密步驟。

---

## 檔案格式解釋

CipherSafe 定義了兩種自訂檔案格式：`.key` 用於儲存金鑰，`.0721` 用於儲存加密資料。

### 金鑰檔案 (`.key`) 格式

一個 `.key` 檔案本質上是一個安全的容器，用於儲存主金鑰。

```
[ 8 bytes ]  Magic Signature: "CSAFEV03"
[ 1 byte  ]  File Type: 0x01 (表示金鑰檔案)
[ 2 bytes ]  元資料區塊長度 (Meta Length)
[ 4 bytes ]  保留標誌位 (Reserved Flags)
[ N bytes ]  元資料區塊 (Metadata Block)
    - [可選] Argon2id 參數 (時間、記憶體、平行度)
    - [可選] 用於密碼派生的鹽 (Salt)
    - [可選] 密碼復原問題及相關資料
[ M bytes ]  金鑰資料 (Key Data)
    - 如果無密碼：直接儲存 32 位元組的主金鑰。
    - 如果有密碼：儲存被密碼加密後的金鑰資料 (Nonce + Ciphertext)。
```

### 加密檔案 (`.0721`) 格式

一個 `.0721` 檔案包含了加密後的所有必要資訊。

```
[ 8 bytes ]  Magic Signature: "CSAFEV03"
[ 1 byte  ]  File Type: 0x02 (表示資料檔案)
[ 2 bytes ]  元資料區塊長度 (Meta Length)
[ 4 bytes ]  保留標誌位 (Reserved Flags)
[ N bytes ]  元資料區塊 (Metadata Block)
    - 加密模式 (金鑰檔案模式 / 密碼模式)
    - [密碼模式] Argon2id 參數和鹽
    - 用於派生 DEK 的鹽 (HKDF Salt)
    - 加密後的檔名及其 Nonce
    - 用於加密檔案內容的初始 Nonce
[ 48 bytes]  被主金鑰加密後的 FNK (Nonce + Ciphertext)
[ M bytes ]  被 DEK 加密的檔案內容 (Ciphertext + Auth Tag)
```

## 安全聲明

本軟體按「原樣」提供，不附帶任何形式的保證。使用者應自行承擔使用本軟體的風險，包括但不限於資料遺失。**強烈建議您備份您的金鑰檔案、密碼和原始資料。** 作者不對因密碼遺忘、金鑰遺失或軟體錯誤導致的任何損失負責。

## 授權條款

本專案基於 [MIT License](LICENSE) 開源。
